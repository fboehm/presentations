---
title: "Inferring QTL allelic series in multiparental populations"
subtitle: "âš”<br/>with xaringan"
author: "Fred Boehm"
institute: "U. Mass. Medical School"
date: "February 26, 2020 (updated: `r Sys.Date()`)"
bibliography: research.bib
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---


# What are allele effects? 

- In CC and DO, we work with 8 founder allele probabilities


$${Trait} = p_{A}b_A +  
p_{B}b_B +
p_{C}b_C +
p_{D}b_D +
p_{E}b_E +
p_{F}b_F +
p_{G}b_G +
p_{H}b_H + 
\epsilon$$



# What are allele effects?

- Standard QTL methods allow for every founder to have its own allele
- However, founders often share alleles
- Thus, in DO and CC, some QTL have fewer than 8 alleles




# What are allele effects?

- QTL exhibit contrasts in allele effects
- How many alleles are present here? 

```{r, echo = FALSE}
# setup Recla analysis
library(dplyr)
library(ggplot2)
library(qtl2pleio)
library(qtl2)
file <- paste0("https://raw.githubusercontent.com/rqtl/",
               "qtl2data/master/DO_Recla/recla.zip")
recla <- read_cross2(file)
# make sex a covariate for use in qtl2pleio::scan_pvl
recla[[6]][ , 1, drop = FALSE] -> sex
# insert pseudomarkers
insert_pseudomarkers(recla, step = 0.10) -> pseudomap
gm <- pseudomap$`8`
probs <- calc_genoprob(recla, map = pseudomap, cores = 1)
aprobs <- genoprob_to_alleleprob(probs)
kinship <- calc_kinship(aprobs, "loco")
recla$pheno -> ph
log(ph) -> lph
apply(FUN = broman::winsorize, X = lph, MARGIN = 2) -> wlph
as_tibble(wlph) -> wlph_tib
sex2 <- matrix(as.numeric(sex == "female"), ncol = 1)
colnames(sex2) <- "female"
rownames(sex2) <- rownames(aprobs[[1]])
out <- scan1(genoprobs = aprobs, 
             pheno = wlph, 
             kinship = kinship, 
             addcovar = sex2, 
             reml = TRUE
             )
scan1coef(aprobs[ , 8], pheno = wlph[ , 10], kinship = kinship$`8`, 
          reml = TRUE,
          addcovar = sex2) -> s1c_10
scan1coef(aprobs[ , 8], pheno = wlph[ , 22], kinship = kinship$`8`, 
          reml = TRUE,
          addcovar = sex2) -> s1c_22
# subset scan1output objects
s1c_10s <- s1c_10[650:999, ] 
# 650:999 is the same as the interval for the two-dimensional scan.
s1c_22s <- s1c_22[650:999, ]
plot_coefCC(s1c_10s, scan1_output = out[ , 10, drop = FALSE], map = pseudomap, main = "percent time in light", xlab = "Chr 8 position (cM)")
```

---

# Methods for inferring allelic series in QTL studies

1. Parametric bayesian methods [@jannink2003estimating; @wu2004optimal]
1. Nonparametric bayesian methods, such as TIMBR (Crouse, et al. forthcoming)


---

# Early results




---
class: inverse, center, middle

# References

